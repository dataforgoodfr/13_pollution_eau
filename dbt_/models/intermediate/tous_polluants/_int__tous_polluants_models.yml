version: 2

models:
  - name: int__resultats_tous_polluants_udi_dernier
    description: "Résultats des derniers prélèvements pour tous les polluants par UDI. Ce modèle sélectionne le dernier prélèvement pour chaque paramètre et agrège les résultats pour identifier les dépassements des seuils sanitaires et/ou règlementaires."
    columns:
      - name: cdreseau
        description: "Code de l'installation (UDI)."
        type: VARCHAR
        tests:
          - not_null
          - unique

      - name: dernier_prel_datetime
        description: "Date et heure du dernier prélèvement pris en compte dans l'analyse."
        type: TIMESTAMP
        tests:
          - not_null
          - dbt_utils.expression_is_true:  
              expression: ">= CURRENT_DATE - INTERVAL 1 YEAR"

      - name: resultat_all
        description: "Interprétation du résultat en fonction des seuils sanitaires et règlementaires."
        type: VARCHAR
        tests:
          - accepted_values:
              values:
                - "inf_limites"
                - "min_1_parametre_sup_limite_qualite"
                - "min_1_parametre_sup_limite_sanitaire"

      - name: periode
        description: "Période d'analyse des prélèvements (ici, toujours 'dernier_prel')."
        type: VARCHAR
        tests:
          - accepted_values:
              values: ["dernier_prel"]
